import csv
from datetime import datetime

ARQUIVO = 'estoque.csv'

def inicializar_arquivo():
    try:
        with open(ARQUIVO, 'x', newline='') as f:
            writer = csv.writer(f)
            writer.writerow(['produto', 'quantidade', 'tipo', 'data'])
    except FileExistsError:
        pass

def registrar(produto, quantidade, tipo):
    data = datetime.today().strftime('%Y-%m-%d')
    with open(ARQUIVO, 'a', newline='') as f:
        writer = csv.writer(f)
        writer.writerow([produto, quantidade, tipo, data])
    print(f"{tipo.capitalize()} registrada: {quantidade}x {produto} em {data}")

def calcular_estoque():
    estoque = {}
    with open(ARQUIVO, newline='') as f:
        reader = csv.DictReader(f)
        for linha in reader:
            produto = linha['produto']
            quantidade = int(linha['quantidade'])
            tipo = linha['tipo']
            estoque[produto] = estoque.get(produto, 0)
            estoque[produto] += quantidade if tipo == 'entrada' else -quantidade
    return estoque

def relatorio_completo():
    print("\n--- RELATÓRIO COMPLETO ---")
    with open(ARQUIVO, newline='') as f:
        reader = csv.DictReader(f)
        for linha in reader:
            print(f"{linha['data']} - {linha['tipo']} - {linha['produto']}: {linha['quantidade']}")

def relatorio_por_data(data_inicial, data_final):
    print(f"\n--- RELATÓRIO DE {data_inicial} a {data_final} ---")
    with open(ARQUIVO, newline='') as f:
        reader = csv.DictReader(f)
        for linha in reader:
            data = linha['data']
            if data_inicial <= data <= data_final:
                print(f"{data} - {linha['tipo']} - {linha['produto']}: {linha['quantidade']}")

def menu():
    inicializar_arquivo()
    while True:
        print("\n--- MENU ESTOQUE ---")
        print("1 - Entrada de Produto")
        print("2 - Saída de Produto")
        print("3 - Ver Estoque Atual")
        print("4 - Relatório Completo")
        print("5 - Relatório por Intervalo de Datas")
        print("0 - Sair")

        escolha = input("Escolha uma opção: ")

        if escolha == '1':
            produto = input("Nome do produto: ")
            qtd = int(input("Quantidade: "))
            registrar(produto, qtd, 'entrada')
        elif escolha == '2':
            produto = input("Nome do produto: ")
            qtd = int(input("Quantidade: "))
            registrar(produto, qtd, 'saida')
        elif escolha == '3':
            estoque = calcular_estoque()
            print("\n--- ESTOQUE ATUAL ---")
            for prod, qtd in estoque.items():
                print(f"{prod}: {qtd}")
        elif escolha == '4':
            relatorio_completo()
        elif escolha == '5':
            data_ini = input("Data inicial (AAAA-MM-DD): ")
            data_fim = input("Data final (AAAA-MM-DD): ")
            relatorio_por_data(data_ini, data_fim)
        elif escolha == '0':
            break
        else:
            print("Opção inválida!")

if __name__ == '__main__':
    menu()
