<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Suri Cosméticos</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #ffe6f0;
    margin: 0;
    padding: 0;
  }
  header {
    background: #ff4d6d;
    color: white;
    padding: 15px;
    text-align: center;
  }
  nav {
    display: flex;
    justify-content: space-around;
    background: #ccc;
    flex-wrap: wrap;
  }
  nav button {
    padding: 10px 20px;
    border: none;
    background: #ccc;
    cursor: pointer;
    font-weight: bold;
    margin: 6px;
  }
  nav button.active {
    background: #ff4d6d;
    color: white;
  }
  section {
    display: none;
    padding: 20px;
  }
  section.active {
    display: block;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  table, th, td {
    border: 1px solid #999;
  }
  th, td {
    padding: 8px;
    text-align: left;
  }
  input, select {
    padding: 5px;
    margin: 5px 0;
    width: 100%;
    box-sizing: border-box;
  }
  button.action-btn {
    margin: 2px;
    padding: 5px 10px;
    cursor: pointer;
    border: none;
    border-radius: 4px;
  }
  .btn-alterar {
    background-color: #ffa500;
    color: white;
  }
  .btn-excluir {
    background-color: #ff0000;
    color: white;
  }
  .small {
    width: auto;
    display: inline-block;
  }
  .row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    align-items: end;
  }
  @media(max-width:600px){
    .row { grid-template-columns: 1fr; }
    nav { justify-content: center; }
  }
</style>
</head>
<body>
<header>
  <h1>Suri Cosméticos</h1>
</header>

<nav>
  <button class="tab-btn active" data-tab="produtos">Produtos</button>
  <button class="tab-btn" data-tab="clientes">Clientes</button>
  <button class="tab-btn" data-tab="entrada">Entrada</button>
  <button class="tab-btn" data-tab="vendas">Vendas</button>
</nav>

<section id="produtos" class="active">
  <h2>Produtos</h2>
  <div class="row">
    <input type="text" id="produto-nome" placeholder="Nome do Produto">
    <input type="number" id="produto-preco" placeholder="Preço (ex: 12.50)" step="0.01" min="0">
  </div>
  <button onclick="adicionarProduto()">Adicionar Produto</button>
  <table id="produtos-tabela">
    <thead>
      <tr>
        <th>Produto</th>
        <th>Preço</th>
        <th>Saldo</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="clientes">
  <h2>Clientes</h2>
  <div class="row">
    <input type="text" id="cliente-nome" placeholder="Nome do Cliente">
    <input type="text" id="cliente-telefone" placeholder="Telefone (ex: (11) 99999-9999)">
  </div>
  <button onclick="adicionarCliente()">Adicionar Cliente</button>
  <table id="clientes-tabela">
    <thead>
      <tr>
        <th>Cliente</th>
        <th>Telefone</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="entrada">
  <h2>Entrada de Produtos</h2>
  <div class="row">
    <select id="entrada-produto"></select>
    <input type="number" id="entrada-quantidade" placeholder="Quantidade" min="1" step="1">
  </div>
  <input type="text" id="entrada-nota" placeholder="Nota Fiscal">
  <button onclick="adicionarEntrada()">Adicionar Entrada</button>
  <table id="entrada-tabela">
    <thead>
      <tr>
        <th>Produto</th>
        <th>Quantidade</th>
        <th>Nota Fiscal</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="vendas">
  <h2>Vendas</h2>
  <div class="row">
    <select id="venda-produto"></select>
    <select id="venda-cliente"></select>
  </div>
  <div class="row">
    <input type="number" id="venda-quantidade" placeholder="Quantidade" min="1" step="1">
    <input type="number" id="venda-valor" placeholder="Valor Unitário (ex: 12.50)" step="0.01" min="0">
  </div>
  <div class="row">
    <input type="number" id="venda-parcelas" placeholder="Número de parcelas (ex: 1)" min="1" step="1" value="1">
    <button onclick="adicionarVenda()" class="small">Registrar Venda</button>
  </div>

  <table id="vendas-tabela">
    <thead>
      <tr>
        <th>Produto</th>
        <th>Cliente</th>
        <th>Quantidade</th>
        <th>Valor Total</th>
        <th>Parcelas</th>
        <th>Valor / Parcela</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<script>
  // Controle das abas (troca de cor para a aba ativa)
  const tabs = document.querySelectorAll('.tab-btn');
  const sections = document.querySelectorAll('section');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      const target = tab.getAttribute('data-tab');
      sections.forEach(sec => sec.classList.remove('active'));
      document.getElementById(target).classList.add('active');
      atualizarSelects();
    });
  });

  // Dados em memória (local)
  let produtos = [];
  let clientes = [];
  let entradas = [];
  let vendas = [];

  // Cria botão de ação (Alterar / Excluir)
  function criarBotaoAcao(texto, classe, callback) {
    const btn = document.createElement('button');
    btn.textContent = texto;
    btn.className = `action-btn ${classe}`;
    btn.onclick = callback;
    return btn;
  }

  /* ---------------------------
     Produtos
  ----------------------------*/
  function adicionarProduto() {
    const nome = document.getElementById('produto-nome').value.trim();
    const preco = parseFloat(document.getElementById('produto-preco').value);
    if (!nome || isNaN(preco)) return alert('Preencha nome e preço válidos.');
    produtos.push({ nome, preco: +preco, saldo: 0 });
    document.getElementById('produto-nome').value = '';
    document.getElementById('produto-preco').value = '';
    atualizarProdutos();
    atualizarSelects();
  }

  function atualizarProdutos() {
    const tbody = document.querySelector('#produtos-tabela tbody');
    tbody.innerHTML = '';
    produtos.forEach((p, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${p.nome}</td><td>${p.preco.toFixed(2)}</td><td>${p.saldo}</td>`;
      const tdAcoes = document.createElement('td');
      tdAcoes.appendChild(criarBotaoAcao('Alterar', 'btn-alterar', () => alterarProduto(i)));
      tdAcoes.appendChild(criarBotaoAcao('Excluir', 'btn-excluir', () => excluirProduto(i)));
      tr.appendChild(tdAcoes);
      tbody.appendChild(tr);
    });
  }

  function alterarProduto(index) {
    const senha = prompt('Digite a senha para alterar:');
    if (senha !== '1234') return alert('Senha incorreta');
    const produtoAntigo = produtos[index].nome;
    const nome = prompt('Novo nome', produtos[index].nome);
    const precoStr = prompt('Novo preço', produtos[index].preco.toFixed(2));
    const preco = parseFloat(precoStr);
    if (!nome || isNaN(preco)) return alert('Nome ou preço inválidos');
    // Atualiza produto
    produtos[index].nome = nome;
    produtos[index].preco = +preco;
    // Atualiza referências em entradas e vendas (manter histórico consistente)
    entradas.forEach(e => { if (e.produto === produtoAntigo) e.produto = nome; });
    vendas.forEach(v => { if (v.produto === produtoAntigo) v.produto = nome; });
    atualizarProdutos();
    atualizarEntradas();
    atualizarVendas();
    atualizarSelects();
  }

  function excluirProduto(index) {
    const senha = prompt('Digite a senha para excluir:');
    if (senha !== '1234') return alert('Senha incorreta');
    // Ajuste: ao excluir produto, removemos também entradas e vendas relacionadas
    const nomeRemovido = produtos[index].nome;
    // Reverter saldo afetando apenas com base nas entradas/vendas existentes antes da remoção.
    // Para manter simples e previsível, vamos remover entradas/vendas que referenciem esse produto
    entradas = entradas.filter(e => e.produto !== nomeRemovido);
    vendas = vendas.filter(v => v.produto !== nomeRemovido);
    produtos.splice(index, 1);
    atualizarProdutos();
    atualizarEntradas();
    atualizarVendas();
    atualizarSelects();
  }

  /* ---------------------------
     Clientes
  ----------------------------*/
  function adicionarCliente() {
    const nome = document.getElementById('cliente-nome').value.trim();
    const telefone = document.getElementById('cliente-telefone').value.trim();
    if (!nome) return alert('Preencha o nome do cliente.');
    clientes.push({ nome, telefone });
    document.getElementById('cliente-nome').value = '';
    document.getElementById('cliente-telefone').value = '';
    atualizarClientes();
    atualizarSelects();
  }

  function atualizarClientes() {
    const tbody = document.querySelector('#clientes-tabela tbody');
    tbody.innerHTML = '';
    clientes.forEach((c, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${c.nome}</td><td>${c.telefone || ''}</td>`;
      const tdAcoes = document.createElement('td');
      tdAcoes.appendChild(criarBotaoAcao('Alterar', 'btn-alterar', () => alterarCliente(i)));
      tdAcoes.appendChild(criarBotaoAcao('Excluir', 'btn-excluir', () => excluirCliente(i)));
      tr.appendChild(tdAcoes);
      tbody.appendChild(tr);
    });
  }

  function alterarCliente(index) {
    const senha = prompt('Digite a senha para alterar:');
    if (senha !== '1234') return alert('Senha incorreta');
    const clienteAntigo = clientes[index].nome;
    const nome = prompt('Novo nome', clientes[index].nome);
    const telefone = prompt('Novo telefone', clientes[index].telefone || '');
    if (!nome) return alert('Nome inválido');
    clientes[index].nome = nome;
    clientes[index].telefone = telefone;
    // Atualiza vendas que usam o nome do cliente (manter histórico consistente)
    vendas.forEach(v => { if (v.cliente === clienteAntigo) v.cliente = nome; });
    atualizarClientes();
    atualizarVendas();
    atualizarSelects();
  }

  function excluirCliente(index) {
    const senha = prompt('Digite a senha para excluir:');
    if (senha !== '1234') return alert('Senha incorreta');
    const nomeRemovido = clientes[index].nome;
    // Remover vendas relacionadas ao cliente (para evitar inconsistência)
    vendas = vendas.filter(v => v.cliente !== nomeRemovido);
    clientes.splice(index, 1);
    atualizarClientes();
    atualizarVendas();
    atualizarSelects();
  }

  /* ---------------------------
     Entradas
  ----------------------------*/
  function adicionarEntrada() {
    const entradaSelect = document.getElementById('entrada-produto');
    const produtoIndex = entradaSelect.value;
    const quantidade = parseInt(document.getElementById('entrada-quantidade').value);
    const nota = document.getElementById('entrada-nota').value.trim();
    if (produtoIndex === '' || isNaN(quantidade) || quantidade <= 0 || !nota) return alert('Preencha todos os campos da entrada corretamente.');
    const produto = produtos[produtoIndex];
    produto.saldo += quantidade;
    entradas.push({ produto: produto.nome, quantidade, nota });
    document.getElementById('entrada-quantidade').value = '';
    document.getElementById('entrada-nota').value = '';
    atualizarEntradas();
    atualizarProdutos();
    atualizarSelects();
  }

  function atualizarEntradas() {
    const tbody = document.querySelector('#entrada-tabela tbody');
    tbody.innerHTML = '';
    entradas.forEach((e, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${e.produto}</td><td>${e.quantidade}</td><td>${e.nota}</td>`;
      const tdAcoes = document.createElement('td');
      tdAcoes.appendChild(criarBotaoAcao('Alterar', 'btn-alterar', () => alterarEntrada(i)));
      tdAcoes.appendChild(criarBotaoAcao('Excluir', 'btn-excluir', () => excluirEntrada(i)));
      tr.appendChild(tdAcoes);
      tbody.appendChild(tr);
    });
  }

  function alterarEntrada(index) {
    const senha = prompt('Digite a senha para alterar:');
    if (senha !== '1234') return alert('Senha incorreta');
    const entrada = entradas[index];
    const quantidadeNova = parseInt(prompt('Nova quantidade', entrada.quantidade));
    const notaNova = prompt('Nova nota fiscal', entrada.nota);
    if (isNaN(quantidadeNova) || quantidadeNova <= 0 || !notaNova) return alert('Quantidade ou nota inválida');
    // Ajusta saldo do produto correspondente
    const produto = produtos.find(p => p.nome === entrada.produto);
    if (produto) {
      produto.saldo -= entrada.quantidade; // remove quantidade antiga
      produto.saldo += quantidadeNova;     // aplica nova quantidade
    }
    entrada.quantidade = quantidadeNova;
    entrada.nota = notaNova;
    atualizarEntradas();
    atualizarProdutos();
  }

  function excluirEntrada(index) {
    const senha = prompt('Digite a senha para excluir:');
    if (senha !== '1234') return alert('Senha incorreta');
    const entrada = entradas[index];
    const produto = produtos.find(p => p.nome === entrada.produto);
    if (produto) produto.saldo -= entrada.quantidade;
    entradas.splice(index, 1);
    atualizarEntradas();
    atualizarProdutos();
  }

  /* ---------------------------
     Vendas (com parcelas)
  ----------------------------*/
  function adicionarVenda() {
    const produtoIndex = document.getElementById('venda-produto').value;
    const clienteIndex = document.getElementById('venda-cliente').value;
    const quantidade = parseInt(document.getElementById('venda-quantidade').value);
    const valor = parseFloat(document.getElementById('venda-valor').value);
    const parcelas = parseInt(document.getElementById('venda-parcelas').value) || 1;

    if (produtoIndex === '' || clienteIndex === '' || isNaN(quantidade) || isNaN(valor) || quantidade <= 0 || valor < 0 || parcelas <= 0) {
      return alert('Preencha todos os campos da venda corretamente.');
    }
    const produto = produtos[produtoIndex];
    if (!produto) return alert('Produto inválido.');
    if (quantidade > produto.saldo) return alert('Quantidade maior que o saldo disponível.');
    produto.saldo -= quantidade;
    const cliente = clientes[clienteIndex] || { nome: '---', telefone: '' };
    const valorTotal = +(quantidade * valor);
    vendas.push({
      produto: produto.nome,
      cliente: cliente.nome,
      quantidade,
      valorUnit: +valor,
      valorTotal,
      parcelas: +parcelas
    });
    document.getElementById('venda-quantidade').value = '';
    document.getElementById('venda-valor').value = '';
    document.getElementById('venda-parcelas').value = '1';
    atualizarVendas();
    atualizarProdutos();
    atualizarSelects();
  }

  function atualizarVendas() {
    const tbody = document.querySelector('#vendas-tabela tbody');
    tbody.innerHTML = '';
    vendas.forEach((v, i) => {
      const valorParcela = v.parcelas > 0 ? (v.valorTotal / v.parcelas) : v.valorTotal;
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${v.produto}</td>
                      <td>${v.cliente}</td>
                      <td>${v.quantidade}</td>
                      <td>${v.valorTotal.toFixed(2)}</td>
                      <td>${v.parcelas}</td>
                      <td>${valorParcela.toFixed(2)}</td>`;
      const tdAcoes = document.createElement('td');
      tdAcoes.appendChild(criarBotaoAcao('Alterar', 'btn-alterar', () => alterarVenda(i)));
      tdAcoes.appendChild(criarBotaoAcao('Excluir', 'btn-excluir', () => excluirVenda(i)));
      tr.appendChild(tdAcoes);
      tbody.appendChild(tr);
    });
  }

  function alterarVenda(index) {
    const senha = prompt('Digite a senha para alterar:');
    if (senha !== '1234') return alert('Senha incorreta');
    const venda = vendas[index];
    // Permitir alterar quantidade, valor unitário e parcelas
    const quantidadeNova = parseInt(prompt('Nova quantidade', venda.quantidade));
    const valorUnitNovo = parseFloat(prompt('Novo valor unitário', venda.valorUnit.toFixed(2)));
    const parcelasNovas = parseInt(prompt('Novo número de parcelas', venda.parcelas));
    if (isNaN(quantidadeNova) || quantidadeNova <= 0 || isNaN(valorUnitNovo) || valorUnitNovo < 0 || isNaN(parcelasNovas) || parcelasNovas <= 0) {
      return alert('Valores inválidos.');
    }
    // Ajustar saldo do produto (restitui a quantidade antiga e remove a nova)
    const produto = produtos.find(p => p.nome === venda.produto);
    if (!produto) return alert('Produto da venda não encontrado.');
    // Verifica disponibilidade caso aumente a quantidade
    const diff = quantidadeNova - venda.quantidade;
    if (diff > 0 && diff > produto.saldo) return alert('Não há saldo suficiente para aumentar a quantidade.');
    produto.saldo -= diff; // se diff é positivo reduz saldo; se negativo aumenta saldo
    venda.quantidade = quantidadeNova;
    venda.valorUnit = +valorUnitNovo;
    venda.valorTotal = +(quantidadeNova * valorUnitNovo);
    venda.parcelas = parcelasNovas;
    atualizarVendas();
    atualizarProdutos();
  }

  function excluirVenda(index) {
    const senha = prompt('Digite a senha para excluir:');
    if (senha !== '1234') return alert('Senha incorreta');
    const venda = vendas[index];
    const produto = produtos.find(p => p.nome === venda.produto);
    if (produto) produto.saldo += venda.quantidade;
    vendas.splice(index, 1);
    atualizarVendas();
    atualizarProdutos();
  }

  /* ---------------------------
     Atualiza selects (produtos e clientes)
  ----------------------------*/
  function atualizarSelects() {
    const entradaSelect = document.getElementById('entrada-produto');
    const vendaProdutoSelect = document.getElementById('venda-produto');
    const vendaClienteSelect = document.getElementById('venda-cliente');

    // Produtos
    [entradaSelect, vendaProdutoSelect].forEach(select => {
      select.innerHTML = '';
      if (produtos.length === 0) {
        const opt = document.createElement('option');
        opt.value = '';
        opt.textContent = '— Nenhum produto —';
        select.appendChild(opt);
        select.value = '';
      } else {
        produtos.forEach((p, i) => {
          const opt = document.createElement('option');
          opt.value = i;
          opt.textContent = `${p.nome} (saldo: ${p.saldo})`;
          select.appendChild(opt);
        });
      }
    });

    // Clientes
    vendaClienteSelect.innerHTML = '';
    if (clientes.length === 0) {
      const opt = document.createElement('option');
      opt.value = '';
      opt.textContent = '— Nenhum cliente —';
      vendaClienteSelect.appendChild(opt);
      vendaClienteSelect.value = '';
    } else {
      clientes.forEach((c, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `${c.nome}${c.telefone ? ' — ' + c.telefone : ''}`;
        vendaClienteSelect.appendChild(opt);
      });
    }
  }

  // Inicializa visualizações vazias
  atualizarProdutos();
  atualizarClientes();
  atualizarEntradas();
  atualizarVendas();
  atualizarSelects();
</script>
</body>
</html>
